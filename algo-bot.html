<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Algo Bot — Matthieu Farbos</title>
    <meta name="description" content="Algo Bot — à venir" />
    <link rel="prefetch" href="index.html" />
    <link rel="prefetch" href="projets.html" />
    <style>
      html, body { height: 100%; margin: 0; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: #0b0f14; color: #fff; overflow: hidden; opacity: 0; transition: opacity .25s ease; }
      #bg { position: fixed; inset: 0; z-index: 0; background: #0a0e12; }

      .overlay { position: relative; z-index: 10; height: 100dvh; display: grid; place-items: center; text-align: center; padding: 24px; }
      h1 { margin: 0 0 8px; font-weight: 700; font-size: clamp(28px, 6vw, 64px); line-height: 1.15; text-shadow: 0 2px 16px rgba(0,0,0,0.6); }
      p.sub { margin: 0; opacity: .8; }

      .credit { position: fixed; right: 8px; bottom: 56px; z-index: 1; font-size: 12px; opacity: 0.65; }
      .credit a { color: #fff; }
      .credit-name { position: fixed; left: 28px; bottom: 56px; z-index: 1; font-size: 12px; opacity: 0.75; }

      .footer { position: fixed; left: 0; right: 0; bottom: 0; z-index: 20; display: flex; align-items: center; justify-content: space-between; gap: 12px; padding: 10px 14px; background: rgba(10,14,18,0.72); border-top: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); font-size: 14px; }
      .footer .links { display: flex; gap: 16px; align-items: center; }
      .footer a { color: #fff; text-decoration: none; opacity: 0.9; }
      .footer a:hover { opacity: 1; text-decoration: underline; }
      .footer .lang { display: flex; align-items: center; gap: 8px; }
      .footer .lang label { opacity: 0.8; }
      .footer .lang button { appearance: none; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.06); color: #fff; padding: 6px 10px; border-radius: 8px; cursor: pointer; font-size: 13px; }
      .footer .lang button:hover { background: rgba(255,255,255,0.12); }
      .footer .lang button.active { background: rgba(66,133,244,0.35); border-color: rgba(66,133,244,0.6); }

      .btn-back { position: fixed; top: 8px; left: 8px; z-index: 30; padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); color: #fff; text-decoration: none; background: rgba(255,255,255,0.06); }
      .btn-back:hover { background: rgba(255,255,255,0.12); }

            .btn-back { position: fixed; top: 8px; left: 8px; z-index: 30; padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); color: #fff; text-decoration: none; background: rgba(255,255,255,0.06); }
      .btn-back:hover { background: rgba(255,255,255,0.12); }
      :root{ --topbar-h: 56px; --footer-h: 56px; }
      .topbar{ position: sticky; top: 0; z-index: 30; display:flex; align-items:center; justify-content: space-between; gap:12px; padding: 10px 16px; background: rgba(10,14,18,0.9); border-bottom:1px solid rgba(255,255,255,0.08); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); }
      .tabs{ display:flex; gap:8px; }
      .tabs .tab-btn{ appearance:none; border:1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.06); color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; font-size:14px; }
      .tabs .tab-btn.active{ background: rgba(66,133,244,0.35); border-color: rgba(66,133,244,0.6); }
      .panes{ height: calc(100vh - var(--topbar-h) - var(--footer-h)); }
      .pane{ height: 100%; }
      .pane iframe{ width:100%; height:100%; border:0; display:block; background:#0b1020; }
      .charts{ height:100%; display:flex; flex-direction:column; gap:12px; padding:12px; }
      .chartbox{ flex:1 1 0; min-height: 220px; background: rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.12); border-radius:12px; padding:10px; }
      .chartbox canvas{ width:100%; height:100%; display:block; }
      .credit, .credit-name{ display:none !important; }
    </style>
  </head>
  <body>
    <div id="bg"></div>`r`n    <a class="btn-back" href="projets.html" id="back-link">&#8592; Retour aux projets</a>

        <main class="overlay" style="height:auto; display:block; text-align:left; padding:0;">
      <div class=\\"topbar\\">`r`n        <h1 id="title" style="margin:0; font-size:20px;">Algo Bot</h1>
        <div class="tabs">
          <button type="button" class="tab-btn active" data-tab="dash" id="tab-dash">Tableau de bord</button>
          <button type="button" class="tab-btn" data-tab="trades" id="tab-trades">Trades</button>
        </div>
      </div>
      <div class="panes">
        <section class="pane" id="pane-dash">
          <iframe src="orb-nq.html" title="ORB NQ Dashboard"></iframe>
        </section>
        <section class="pane" id="pane-trades" hidden>
          <div class="charts">
            <div class="chartbox"><canvas id="chart-bars"></canvas></div>
            <div class="chartbox"><canvas id="chart-cum"></canvas></div>
          </div>
        </section>
      </div>
    </main>

    <div class="credit">Données et graphique par <a href="https://www.tradingview.com/widget/advanced-chart/" target="_blank" rel="noopener">TradingView</a></div>
    <div class="credit-name">© Matthieu Farbos</div>

    <nav class="footer" aria-label="Navigation bas de page">
      <div class="links">
        <a href="index.html" id="nav-home">Accueil</a>
        <a href="projets.html" id="nav-projects">Projets</a>
      </div>
      <div class="lang" role="group" aria-label="Choix de langue">
        <label>Langue:</label>
        <button type="button" data-lang="fr" aria-pressed="false" id="btn-fr">FR</button>
        <button type="button" data-lang="en" aria-pressed="false" id="btn-en">EN</button>
      </div>
    </nav>

    <!-- No TradingView script on this page background -->
    <script>
      // Seamless page transitions
      function setupTransitions() {
        requestAnimationFrame(() => { document.body.style.opacity = '1'; });
        document.querySelectorAll('a[href]').forEach(a => {
          const href = a.getAttribute('href');
          if (!href || href.startsWith('http') || href.startsWith('#') || a.target === '_blank') return;
          a.addEventListener('click', (e) => {
            e.preventDefault(); document.body.style.opacity = '0';
            setTimeout(() => { window.location.href = a.href; }, 200);
          });
        });
      }

      const SYMBOL = 'NASDAQ:GOOGL';
      const storageKey = 'site.lang';
      let currentLang = (localStorage.getItem(storageKey) || 'fr');

      function setActiveButtons() {
        const frBtn = document.getElementById('btn-fr');
        const enBtn = document.getElementById('btn-en');
        frBtn.classList.toggle('active', currentLang === 'fr');
        enBtn.classList.toggle('active', currentLang === 'en');
        frBtn.setAttribute('aria-pressed', String(currentLang === 'fr'));
        enBtn.setAttribute('aria-pressed', String(currentLang === 'en'));
      }

      function initChart() { /* disabled */ }

      function applyLanguage(lang) {
        currentLang = (lang === 'en') ? 'en' : 'fr';
        localStorage.setItem(storageKey, currentLang);
        setActiveButtons();
        const navHome = document.getElementById('nav-home');
        const navProjects = document.getElementById('nav-projects');
        const langLabel = document.querySelector('.lang label');
        const title = document.getElementById('title');
        const subtitle = document.getElementById('subtitle');
        const back = document.getElementById('back-link');
        if (currentLang === 'fr') {
          navHome.textContent = 'Accueil'; navProjects.textContent = 'Projets'; langLabel.textContent = 'Langue:';
          title.textContent = 'Algo Bot'; subtitle.textContent = 'Suivi live ORB NQ'; var td=document.getElementById('tab-dash'); var tt=document.getElementById('tab-trades'); if(td){td.textContent='Tableau de bord';} if(tt){tt.textContent='Trades';} back.textContent = '? Retour aux projets';
        } else {
          navHome.textContent = 'Home'; navProjects.textContent = 'Projects'; langLabel.textContent = 'Language:';
          title.textContent = 'Algo Bot'; subtitle.textContent = 'Live ORB NQ'; var td=document.getElementById('tab-dash'); var tt=document.getElementById('tab-trades'); if(td){td.textContent='Dashboard';} if(tt){tt.textContent='Trades';} back.textContent = '? Back to projects';
        }
        if (window.TradingView) initChart();
      }

      if (window.TradingView) { initChart(); }
      else { window.addEventListener('load', initChart); }

      window.addEventListener('DOMContentLoaded', function() {
        setupTransitions();
        setActiveButtons();
        applyLanguage(currentLang);
        document.getElementById('btn-fr').addEventListener('click', () => applyLanguage('fr'));
        document.getElementById('btn-en').addEventListener('click', () => applyLanguage('en'));
      });
    </script>
    <script>
      // Global language toggle wiring so FR/EN works consistently
      (function() {
        if (window.__globalLangWired) return; window.__globalLangWired = true;
        function setActive(cur){ var fr=document.getElementById('btn-fr'); var en=document.getElementById('btn-en'); if(!fr||!en) return; fr.classList.toggle('active',cur==='fr'); en.classList.toggle('active',cur==='en'); fr.setAttribute('aria-pressed',String(cur==='fr')); en.setAttribute('aria-pressed',String(cur==='en')); }
        function setLang(lang){ var val=(lang==='en')?'en':'fr'; localStorage.setItem('site.lang',val); if(typeof applyLanguage==='function'){ applyLanguage(val); } else { location.reload(); } setActive(val); }
        window.addEventListener('DOMContentLoaded', function(){ var cur=localStorage.getItem('site.lang')||'fr'; setActive(cur); var fr=document.getElementById('btn-fr'); var en=document.getElementById('btn-en'); if(fr) fr.addEventListener('click', function(){ setLang('fr'); }); if(en) en.addEventListener('click', function(){ setLang('en'); }); });
      })();
    </script>
      <script>
      (function(){
        function qs(s){ return document.querySelector(s); }
        function qsa(s){ return Array.from(document.querySelectorAll(s)); }
        function setActiveTab(tab){
          qsa(".tab-btn").forEach(function(b){ b.classList.toggle('active', b.dataset.tab===tab); });
          qs('#pane-dash').hidden = (tab!=='dash');
          qs('#pane-trades').hidden = (tab!=='trades');
        }
        function drawBars(canvas, data){
          var ctx = canvas.getContext('2d');
          var dpr = window.devicePixelRatio||1; var w = canvas.clientWidth, h = canvas.clientHeight;
          canvas.width = w*dpr; canvas.height = h*dpr; ctx.setTransform(dpr,0,0,dpr,0,0);
          ctx.clearRect(0,0,w,h);
          var n = data.length; if(!n) return;
          var dates = data.map(function(d){return d.date});
          var vals = data.map(function(d){return +d.pnl_usd});
          var min = Math.min.apply(null, [0].concat(vals));
          var max = Math.max.apply(null, [0].concat(vals));
          var pad = 24; var x0=pad, y0=pad, W=w-2*pad, H=h-2*pad;
          var barW = Math.max(8, Math.floor(W/(n*1.5)));
          var xStep = W/n;
          function yScale(v){ return y0 + H - ( (v-min) / ( (max-min)||1 ) * H ); }
          var yZero = yScale(0); ctx.strokeStyle = 'rgba(255,255,255,0.35)'; ctx.beginPath(); ctx.moveTo(x0,yZero); ctx.lineTo(x0+W,yZero); ctx.stroke();
          for(var i=0;i<n;i++){
            var x = x0 + i*xStep + (xStep-barW)/2;
            var y = yScale(vals[i]);
            ctx.fillStyle = (vals[i]>=0 ? '#4caf50' : '#f44336');
            ctx.fillRect(x, Math.min(y,yZero), barW, Math.abs(y - yZero));
          }
          ctx.fillStyle='rgba(255,255,255,0.7)'; ctx.font='12px system-ui';
          for(var j=0;j<n;j+=Math.ceil(n/4)){
            var tx = x0 + j*xStep; ctx.fillText(dates[j], tx, h-6);
          }
        }
        function drawLine(canvas, data){
          var ctx = canvas.getContext('2d');
          var dpr = window.devicePixelRatio||1; var w = canvas.clientWidth, h = canvas.clientHeight;
          canvas.width = w*dpr; canvas.height = h*dpr; ctx.setTransform(dpr,0,0,dpr,0,0);
          ctx.clearRect(0,0,w,h);
          var n = data.length; if(!n) return;
          var vals = []; var acc=0; for(var i=0;i<n;i++){ acc += +data[i].pnl_usd; vals.push(acc); }
          var min = Math.min.apply(null, vals); var max = Math.max.apply(null, vals);
          var pad = 24; var x0=pad, y0=pad, W=w-2*pad, H=h-2*pad;
          function yScale(v){ return y0 + H - ( (v-min) / ( (max-min)||1 ) * H ); }
          function xScale(i){ return x0 + ( (n<=1?0:i/(n-1)) * W ); }
          ctx.strokeStyle='#4aa3ff'; ctx.lineWidth=2; ctx.beginPath();
          for(var k=0;k<n;k++){ var x=xScale(k), y=yScale(vals[k]); if(k){ ctx.lineTo(x,y); } else { ctx.moveTo(x,y); } }
          ctx.stroke();
          var yZero = yScale(0); ctx.strokeStyle='rgba(255,255,255,0.35)'; ctx.beginPath(); ctx.moveTo(x0,yZero); ctx.lineTo(x0+W,yZero); ctx.stroke();
        }
        function updateTabLabels(){
          var fr = (localStorage.getItem('site.lang')||'fr')==='fr';
          var td=document.getElementById('tab-dash'); var tt=document.getElementById('tab-trades');
          if(td) td.textContent = fr ? 'Tableau de bord' : 'Dashboard';
          if(tt) tt.textContent = 'Trades';
        }
        async function load(){
          updateTabLabels();
          var tabs = Array.from(document.querySelectorAll('.tab-btn')); tabs.forEach(function(b){ b.addEventListener('click', function(){ setActiveTab(b.dataset.tab); }); });
          setActiveTab('dash');
          try{
            var r = await fetch('opening_range_reports/summary.json?ts='+Date.now());
            var sum = await r.json();
            var last10 = (sum.last_10||[]);
            drawBars(document.getElementById('chart-bars'), last10);
            drawLine(document.getElementById('chart-cum'), last10);
            window.addEventListener('resize', function(){
              drawBars(document.getElementById('chart-bars'), last10);
              drawLine(document.getElementById('chart-cum'), last10);
            });
          }catch(e){ console.warn('Charts load failed', e); }
        }
        window.addEventListener('DOMContentLoaded', load);
      })();
    </script></body>
  </html>
